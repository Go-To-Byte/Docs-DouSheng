<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>花3分钟写的简易IoC，放在Golang的项目中太好用了 | Go-To-Byte 抖声项目文档</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="极简版抖音相关文档">
    
    <link rel="preload" href="/Docs-DouSheng/assets/css/0.styles.8eec8595.css" as="style"><link rel="preload" href="/Docs-DouSheng/assets/js/app.c54b96a2.js" as="script"><link rel="preload" href="/Docs-DouSheng/assets/js/3.7c9615c7.js" as="script"><link rel="preload" href="/Docs-DouSheng/assets/js/1.09f60839.js" as="script"><link rel="preload" href="/Docs-DouSheng/assets/js/12.f2b67662.js" as="script"><link rel="prefetch" href="/Docs-DouSheng/assets/js/10.0a13617d.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/11.fffa9699.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/13.d6a0ee73.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/14.e3110fe4.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/15.a8ab4c1a.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/16.86137cae.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/17.5e3e25b8.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/18.39b132cd.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/19.4556075a.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/20.d09eb622.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/21.18e033bd.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/22.cf2715e5.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/23.e6032951.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/24.5ddaaff3.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/25.8adde32e.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/26.6bfcc7a0.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/27.20992d63.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/28.8d0d59e2.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/29.aa548538.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/30.018e1cfb.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/4.c941b0df.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/5.1472538b.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/6.bba527e6.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/7.b9d4e63c.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/8.3cee3583.js"><link rel="prefetch" href="/Docs-DouSheng/assets/js/9.9011edd2.js">
    <link rel="stylesheet" href="/Docs-DouSheng/assets/css/0.styles.8eec8595.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-717a9a92><div data-v-717a9a92><div class="password-shadow password-wrapper-out" style="display:none;" data-v-045785d8 data-v-717a9a92 data-v-717a9a92><h3 class="title" data-v-045785d8>Go-To-Byte 抖声项目文档</h3> <p class="description" data-v-045785d8>极简版抖音相关文档</p> <label id="box" class="inputBox" data-v-045785d8><input type="password" value="" data-v-045785d8> <span data-v-045785d8>Konck! Knock!</span> <button data-v-045785d8>OK</button></label> <div class="footer" data-v-045785d8><span data-v-045785d8><i class="iconfont reco-theme" data-v-045785d8></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-045785d8>vuePress-theme-reco</a></span> <span data-v-045785d8><i class="iconfont reco-copyright" data-v-045785d8></i> <a data-v-045785d8><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-717a9a92><header class="navbar" data-v-717a9a92><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Docs-DouSheng/" class="home-link router-link-active"><!----> <span class="site-name">Go-To-Byte 抖声项目文档</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Docs-DouSheng/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="https://github.com/Go-To-Byte/DouSheng" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-717a9a92></div> <aside class="sidebar" data-v-717a9a92><div class="personal-info-wrapper" data-v-737b5069 data-v-717a9a92><!----> <!----> <div class="num" data-v-737b5069><div data-v-737b5069><h3 data-v-737b5069>21</h3> <h6 data-v-737b5069>文章</h6></div> <div data-v-737b5069><h3 data-v-737b5069>0</h3> <h6 data-v-737b5069>标签</h6></div></div> <ul class="social-links" data-v-737b5069></ul> <hr data-v-737b5069></div> <nav class="nav-links"><div class="nav-item"><a href="/Docs-DouSheng/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="https://github.com/Go-To-Byte/DouSheng" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/Docs-DouSheng/" class="sidebar-heading clickable router-link-active"><span>欢迎查看</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Docs-DouSheng/" aria-current="page" class="sidebar-link">关于</a></li><li><a href="/Docs-DouSheng/index/team.html" class="sidebar-link">Go-To-Byte</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Docs-DouSheng/handbook/why" class="sidebar-heading clickable"><span>初识Dousheng</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Docs-DouSheng/handbook/why.html" class="sidebar-link">为什么选择 Go</a></li><li><a href="/Docs-DouSheng/handbook/start.html" class="sidebar-link">开始</a></li><li><a href="/Docs-DouSheng/handbook/feature.html" class="sidebar-link">功能特点</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Docs-DouSheng/framework/evolve" class="sidebar-heading clickable open"><span>Dousheng的相关架构</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Docs-DouSheng/framework/evolve.html" class="sidebar-link">Dousheng的架构演变之路</a></li><li><a href="/Docs-DouSheng/framework/lifecycle.html" class="sidebar-link">如何管理DouSheng应用的生命周期</a></li><li><a href="/Docs-DouSheng/framework/ioc.html" aria-current="page" class="active sidebar-link">如何将IoC使用到架构中</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Docs-DouSheng/kit/base" class="sidebar-heading clickable"><span>Dousheng的公共库</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Docs-DouSheng/service/user" class="sidebar-heading clickable"><span>Dousheng的业务实现</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Docs-DouSheng/other/gowork" class="sidebar-heading clickable"><span>其他</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-045785d8 data-v-717a9a92><h3 class="title" data-v-045785d8>花3分钟写的简易IoC，放在Golang的项目中太好用了</h3> <!----> <label id="box" class="inputBox" data-v-045785d8><input type="password" value="" data-v-045785d8> <span data-v-045785d8>Konck! Knock!</span> <button data-v-045785d8>OK</button></label> <div class="footer" data-v-045785d8><span data-v-045785d8><i class="iconfont reco-theme" data-v-045785d8></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-045785d8>vuePress-theme-reco</a></span> <span data-v-045785d8><i class="iconfont reco-copyright" data-v-045785d8></i> <a data-v-045785d8><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-717a9a92><div data-v-717a9a92><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">花3分钟写的简易IoC，放在Golang的项目中太好用了</h1> <div data-v-4841c148><i class="iconfont reco-account" data-v-4841c148><span data-v-4841c148>Ciusyan</span></i> <i class="iconfont reco-date" data-v-4841c148><span data-v-4841c148>2023/2/23</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="花3分钟写的简易ioc-放在golang的项目中太好用了"><a href="#花3分钟写的简易ioc-放在golang的项目中太好用了" class="header-anchor">#</a> 花3分钟写的简易IoC，放在Golang的项目中太好用了~</h1> <p>我给朋友<code>（简称小cher算了🕵️‍♂️🕵️‍♂️）</code>看了我在我<code>Go Project</code>中实现的简易版IOC，实现思路如图所示：</p> <p><img src="https://ciusyan-picgo.oss-cn-shenzhen.aliyuncs.com/images/202302232121034.png" alt="image-20230223212057924"></p> <p>什么？小cher说她看不懂！！！好吧，我的锅。那我来解释解释，什么是IoC？</p> <h2 id="一、什么是ioc"><a href="#一、什么是ioc" class="header-anchor">#</a> 一、什么是IOC</h2> <p>注：<strong>本文是利用了Ioc的一些思想，实现了简易版的IoC容器</strong>，和IoC的原思想并不完全一致。可以小马过河，因人而异~</p> <p><s>🕵️‍♂️🕵️‍♂️<em>小cher说，你用一句话解释I一下<code>IoC</code>的核心思想：</em></s></p> <p>一句话解释：将对象利用控制反转的方式，在容器中创建出Bean<code>（项目的依赖对象）</code>，并且可以自动为每一个<code>Bean</code>注入所需的依赖。</p> <p>再用一句话解释简易版IoC：将依赖对象注入容器中后，用控制反转的方式，从IoC容器中获取所需要的依赖。</p> <p><s>🎅🎅<em>我还补充了一句：</em></s></p> <p>当然，一般从IoC中取出的依赖，也是为了注入给容器中的其它依赖。</p> <p><s>🕵️‍♂️🕵️‍♂️<em>这一下小cher就懵了啊：</em></s></p> <p>什么是控制反转？什么又是依赖？注入之后怎么取出来勒？为什么会有IoC勒？</p> <p>ps：如果这几个概念你很清楚，那咱不浪费大哥们的时间，直接跳第二节去！但是为了照顾像小cher这样cer头cer脑的小朋友，咱们来看看这几个问题~~~</p> <h3 id="_1-什么是依赖注入"><a href="#_1-什么是依赖注入" class="header-anchor">#</a> （1）什么是依赖注入？</h3> <p><s>🎅🎅<em>小cher啊，我先跟你说官方一点的啊：</em></s></p> <h4 id="_1、官方一点的"><a href="#_1、官方一点的" class="header-anchor">#</a> 1、官方一点的</h4> <p><code>DI（Dependency Injection）</code>称为依赖注入。意思是：如果A实例依赖B实例，如下代码所示：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> A <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// A对象依赖对象 B</span>
    b B
<span class="token punctuation">}</span>

<span class="token keyword">type</span> B <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    name <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在程序启动时的时候，会去初始化IoC容器，去初始化对象A的时候，扫描到它需要依赖对象B。IoC会从自身取出B，给A对象中的<code>b字段</code>赋值。</p> <p><s>🕵️‍♂️🕵️‍♂️<em>我说完这句话后：小cher说：</em></s></p> <p>这个过程，如果给A赋值的时候，B对象还未初始化呢？那之后如果调用A.b的方法，不就相当于<code>A.nil.xxx</code>了嘛？</p> <p>是的，所以我们要求，在进行依赖注入的时候，必须要能够在容器中<strong>能找到被依赖</strong>的对象。</p> <hr> <p><s>🕵️‍♂️🕵️‍♂️<em>说完，小cher加上了自己的思考，已经理解大概的意思了，那还有没有简单一点的描述？</em></s></p> <h4 id="_2、简易版"><a href="#_2、简易版" class="header-anchor">#</a> 2、简易版</h4> <p>简单说明了上面的那种解释，再来强化一下理解，因为我们要实现的简易版，依赖注入指的是：</p> <p>如果将程序<strong>刚开始启动</strong>时分为两个阶段</p> <ul><li>阶段一：通过一定的手段，将依赖放入IoC对应的容器中</li> <li>阶段二：去初始化容器中的对象，也就是给容器中每一个对象的属性赋值。</li></ul> <p>也就是图中的这个过程：</p> <p><img src="https://ciusyan-picgo.oss-cn-shenzhen.aliyuncs.com/images/202302232159618.png" alt="image-20230223215943567"></p> <p>🕵<s>️‍♂️🕵️‍♂️<em>图还没看完，小cher说，欧，原来这两个步骤就是依赖注入的过程啊！！！这个懂了，但是我还有个疑惑：你说<strong>通过一定的手段</strong>。具体指的是什么呢？</em></s></p> <h3 id="_2-怎么注入容器"><a href="#_2-怎么注入容器" class="header-anchor">#</a> （2）怎么注入容器？</h3> <p>是啊，怎么通过一定的手段将依赖放入容器呢？这里有几个可借鉴的手段：<strong>可以是配置文件、可以是注解、注释...</strong></p> <p><s>🎅🎅<em>撇开上面这句话，小cher啊，如果有一个盒子，让你把这个球放入一个盒子里，你会怎么放入呢？</em></s></p> <p><s>🕵️‍♂️🕵️‍♂️<em>我啊，我会大致会有两个主线思路吧：</em></s></p> <ol><li>自己手动放进去咯</li> <li>跟我女朋友说，当我这个盒子打开的时候，她就把球自动放进去~🐶🐶</li></ol> <p><s>🎅🎅*？？？满脸羡慕，有女朋友真幸福是吧~ 咳咳，先来继续看这个问题：*</s></p> <p>是的，你挺会思考的啊。主线思路也就是自动放入和手动放入咯，但是我们作为”高级“程序员，会手动操作吗？</p> <p>所以，我们注入容器的过程，就选择自动注册，那怎么注册呢？既然我这里是<code>Go Project</code>，<code>Go语言</code>的程序员围过来，其他语言围观，我们来看一段 <a href="https://github.com/go-sql-driver/mysql/" target="_blank" rel="noopener noreferrer">Go官方的Mysql驱动包<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的代码（主要看标注的）：</p> <p><img src="https://ciusyan-picgo.oss-cn-shenzhen.aliyuncs.com/images/202302232219052.png" alt="image-20230223221933007"></p> <p><s>🎅🎅<em>小cher，相信你猜出我想说什么了吧！</em></s></p> <p><s>🕵️‍♂️🕵️‍♂️<em>那我浅猜一下？你是不是想说：</em></s></p> <p>在程序<strong>刚开始启动</strong>时，如果你的启动入口导入了对应的包，那么就会去加载那个包的一些东西。我在<a href="https://learnku.com/go/t/47178" target="_blank" rel="noopener noreferrer">网上看到了一副图片<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，分享给你看看：</p> <p><img src="https://ciusyan-picgo.oss-cn-shenzhen.aliyuncs.com/images/202302232234979.png" alt="image-20230223223444898"></p> <p>而使用匿名导入，是因为在导入包的地方不需要使用它，只是想去初始化那个包。你看看我说的对吗？？</p> <p><s>🎅🎅<em>哇偶，可以啊，小cher你是懂我的！！！来，碰个杯🍻那我接着你的思路说咯</em></s></p> <p>我们知道了这个原理，那么我们就可以将要放入容器的操作写到<code>init()</code>函数里，比如下面两段伪代码：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> api

<span class="token comment">// 这个包有依赖需要放入IoC容器</span>

<span class="token comment">// ...</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 放入IoC容器的逻辑</span>
    ioc<span class="token punctuation">.</span><span class="token function">DI</span><span class="token punctuation">(</span>需要放入的依赖<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>那么在启动程序的时候：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token boolean">_</span> <span class="token string">&quot;test/api&quot;</span> <span class="token comment">// 去初始化 api 包</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 启动程序 </span>
    <span class="token comment">// ....</span>
<span class="token punctuation">}</span>
</code></pre></div><p><s>🕵️‍♂️🕵️‍♂️<em>小cher看完了这两段代码，豁然开朗，原来是这样啊！！！那我想问问，说控制反转，控制怎么就反转了呢？</em></s></p> <h3 id="_2-控制怎么就反转了"><a href="#_2-控制怎么就反转了" class="header-anchor">#</a> （2）控制怎么就反转了？</h3> <p><s>🎅🎅<em>好的，小cher，看这个问题之前，你再回想一下，你在项目中一般是怎么使用依赖对象的？最好给我看看简单的代码</em></s></p> <p><s>🕵️‍♂️🕵️‍♂️<em>呐，你看</em></s></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 对象A</span>
<span class="token keyword">type</span> A <span class="token keyword">struct</span> <span class="token punctuation">{</span>
   id <span class="token builtin">int</span>
   b  <span class="token operator">*</span>B <span class="token comment">// 这里依赖 B 对象</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对象B的构造函数</span>
<span class="token keyword">func</span> <span class="token function">NewB</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>B <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token operator">&amp;</span>B<span class="token punctuation">{</span>name<span class="token punctuation">:</span> name<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对象B</span>
<span class="token keyword">type</span> B <span class="token keyword">struct</span> <span class="token punctuation">{</span>
   name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   a <span class="token operator">:=</span> A<span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      b<span class="token punctuation">:</span>  <span class="token function">NewB</span><span class="token punctuation">(</span><span class="token string">&quot;ciusyan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 自己控制B对象的初始化</span>
   <span class="token punctuation">}</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>是啊，你看看，你写的这个，你的A对象依赖B对象，你要是给A对象初始化。你需要自己去写初始化代码。我觉得麻烦的地方就是：</p> <ol><li>如果你这个类似的代码在100个地方用了，那么你就会写一百遍类似的代码。如果你的参数突然变化了，那么你又要到那用到的一百个地方修改代码</li> <li>需要自己理清所依赖的对象</li></ol> <p><s>🕵️‍♂️🕵️‍♂️<em>也是偶，那我可以封装一下啊！！！哎，不对，你不就是在利用<code>IoC</code>的思想封装吗</em></s></p> <p>是的，我们使用IoC的方式封装后（你先别管具体怎么封装的）：如何初始化的操作，都被放入容器中了。需要使用对象的时候，直接从容器中取出来即可，比如：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从IOC中获取A对象</span>
   a <span class="token operator">:=</span> ioc<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 它是如何初始化A和B的，我们根本不需要关心</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再给你<a href="https://umajs.github.io/%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD/IOC.html#%E4%BB%80%E4%B9%88%E6%98%AF-ioc" target="_blank" rel="noopener noreferrer">找一副图<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>看看：</p> <p><img src="https://ciusyan-picgo.oss-cn-shenzhen.aliyuncs.com/images/202302232320825.png" alt="image-20230223232055761"></p> <p><s>🕵️‍♂️🕵️‍♂️<em>好吧，确实是，用<code>IoC</code>封装后，使用起来好方便啊，都不需要自己管理依赖的对象了！！！再看你开始给我看的图，好像清晰了很多</em></s></p> <p><img src="https://ciusyan-picgo.oss-cn-shenzhen.aliyuncs.com/images/202302232355799.png" alt="image-20230223235532757"></p> <p>相信你看到这里，你大概也知道为什么会出现IoC了，那我们再来总结一下~</p> <h2 id="二、为什么会有ioc"><a href="#二、为什么会有ioc" class="header-anchor">#</a> 二、为什么会有IOC</h2> <p>一句话解释：方便管理项目的依赖的对象。</p> <p>刚刚所述的，如果很多重复性很大的代码，那一个点咱们不在重复了，我们下面来看看，如果一个对象的依赖很多，那么你可能去理清这个对象的依赖，会很麻烦。</p> <h3 id="_1-没有ioc时"><a href="#_1-没有ioc时" class="header-anchor">#</a> （1）没有IoC时</h3> <p>比如下面没有IoC时的一段伪代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 对象A</span>
type <span class="token class-name">A</span> struct <span class="token punctuation">{</span>
   id <span class="token keyword">int</span>
   b  <span class="token operator">*</span><span class="token class-name">B</span> <span class="token comment">// 这里依赖 B 对象</span>
   c  <span class="token operator">*</span><span class="token class-name">C</span> <span class="token comment">// 这里依赖 C 对象</span>
   d  <span class="token operator">*</span><span class="token class-name">D</span> <span class="token comment">// 这里依赖 D 对象</span>
   e  <span class="token operator">*</span><span class="token class-name">E</span> <span class="token comment">// 这里依赖 E 对象</span>
   f  <span class="token operator">*</span><span class="token class-name">F</span> <span class="token comment">// 这里依赖 F 对象</span>
   g  <span class="token operator">*</span><span class="token class-name">G</span> <span class="token comment">// 这里依赖 G 对象</span>
   h  <span class="token operator">*</span><span class="token class-name">H</span> <span class="token comment">// 这里依赖 H 对象</span>
   <span class="token comment">// ....</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用对象A</span>
a <span class="token operator">:</span><span class="token operator">=</span> <span class="token class-name">A</span><span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      b<span class="token operator">:</span>  <span class="token class-name">NewB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 自己控制B对象的初始化</span>
      c<span class="token operator">:</span>  <span class="token class-name">NewC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 自己控制C对象的初始化</span>
      d<span class="token operator">:</span>  <span class="token class-name">NewD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 自己控制D对象的初始化</span>
      e<span class="token operator">:</span>  <span class="token class-name">NewE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 自己控制E对象的初始化</span>
      f<span class="token operator">:</span>  <span class="token class-name">NewF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 自己控制F对象的初始化</span>
      <span class="token comment">// ....</span>
   <span class="token punctuation">}</span>

</code></pre></div><p><s>🕵️‍♂️🕵️‍♂️<em>小cher看完了这段代码，笑道：之前对象的依赖没那么多，好像确实没多少感觉，看你这个依赖多了后，好像是有点麻烦勒</em></s></p> <h3 id="_2-有ioc之后"><a href="#_2-有ioc之后" class="header-anchor">#</a> （2）有IoC之后</h3> <p>看完了上面的一段伪代码，我想，你肯定觉得很ex吧！那来看看有IoC之后呢？</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 定义这些对象的时候，将这些对象全部注入IoC容器中</span>
ioc<span class="token punctuation">.</span><span class="token function">DI</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> C<span class="token punctuation">,</span> D<span class="token punctuation">,</span> E<span class="token punctuation">,</span> F<span class="token punctuation">,</span> G<span class="token punctuation">,</span> H<span class="token punctuation">)</span>

<span class="token comment">// 使用对象A</span>
a <span class="token operator">:=</span> ioc<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>当然啊，并不是说没有IoC就不行啊，但若你还没有想到好的方案，不妨可以试试用IoC容器化的思想去封装一些东西？</p> <p><s>🎅🎅<em>小cher，聊到现在，相信你应该了解了IoC的一些核心概念，那咱们开始制作装依赖的容器，看看3分钟能不能写完吧！</em></s></p> <h2 id="三、开始实践了"><a href="#三、开始实践了" class="header-anchor">#</a> 三、开始实践了</h2> <p>一般会用很多种容器，来装不一样的依赖。</p> <p><s>🎅🎅<em>小cher，问你个问题，你家里的大衣柜，你不可能把所有衣物，一啪啦的全扔进去吧。</em></s></p> <p><s>🕵️‍♂️🕵️‍♂️<em>肯定不会啊，要不然到时候取的时候太麻烦了，可以分开管理一下的</em></s></p> <p>是我的话，我可能会把它分成很多个装衣服的容器：有装衬衫的、装领带的、装西装、装裤子...</p> <p><s>🎅🎅<em>哈哈哈，是的，既然你也这样认为。那我们多做几个容器，分开管理怎么样。就先来实现一个用来装内部服务对象的容器吧，其余的也是类似思路！</em></s></p> <p><strong>// TODO：可先看项目代码，之后再完善代码</strong></p> <p><a href="https://github.com/Go-To-Byte/DouSheng/tree/main/dou_kit/ioc" target="_blank" rel="noopener noreferrer">项目IoC相关代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_1-初阶简易版本"><a href="#_1-初阶简易版本" class="header-anchor">#</a> （1）初阶简易版本</h3> <p>// TODO</p> <h3 id="_2-完整简易版本"><a href="#_2-完整简易版本" class="header-anchor">#</a> （2）完整简易版本</h3> <p>// TODO</p> <h3 id="_3-拓展ioc"><a href="#_3-拓展ioc" class="header-anchor">#</a> （3）拓展IOC</h3> <p>// TODO</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/Docs-DouSheng/framework/lifecycle.html" class="prev">
          如何管理DouSheng应用的生命周期
        </a></span> <span class="next"><a href="/Docs-DouSheng/kit/base.html">
          dou_kit基础
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-06b3169a data-v-717a9a92><li class="level-2" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#一、什么是ioc" class="sidebar-link reco-side-一、什么是ioc" data-v-06b3169a>一、什么是IOC</a></li><li class="level-3" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#_1-什么是依赖注入" class="sidebar-link reco-side-_1-什么是依赖注入" data-v-06b3169a>（1）什么是依赖注入？</a></li><li class="level-3" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#_2-怎么注入容器" class="sidebar-link reco-side-_2-怎么注入容器" data-v-06b3169a>（2）怎么注入容器？</a></li><li class="level-3" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#_2-控制怎么就反转了" class="sidebar-link reco-side-_2-控制怎么就反转了" data-v-06b3169a>（2）控制怎么就反转了？</a></li><li class="level-2" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#二、为什么会有ioc" class="sidebar-link reco-side-二、为什么会有ioc" data-v-06b3169a>二、为什么会有IOC</a></li><li class="level-3" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#_1-没有ioc时" class="sidebar-link reco-side-_1-没有ioc时" data-v-06b3169a>（1）没有IoC时</a></li><li class="level-3" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#_2-有ioc之后" class="sidebar-link reco-side-_2-有ioc之后" data-v-06b3169a>（2）有IoC之后</a></li><li class="level-2" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#三、开始实践了" class="sidebar-link reco-side-三、开始实践了" data-v-06b3169a>三、开始实践了</a></li><li class="level-3" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#_1-初阶简易版本" class="sidebar-link reco-side-_1-初阶简易版本" data-v-06b3169a>（1）初阶简易版本</a></li><li class="level-3" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#_2-完整简易版本" class="sidebar-link reco-side-_2-完整简易版本" data-v-06b3169a>（2）完整简易版本</a></li><li class="level-3" data-v-06b3169a><a href="/Docs-DouSheng/framework/ioc.html#_3-拓展ioc" class="sidebar-link reco-side-_3-拓展ioc" data-v-06b3169a>（3）拓展IOC</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-e58f9186 data-v-e58f9186><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-e58f9186><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-e58f9186></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-e58f9186></path></svg></div></div></div>
    <script src="/Docs-DouSheng/assets/js/app.c54b96a2.js" defer></script><script src="/Docs-DouSheng/assets/js/3.7c9615c7.js" defer></script><script src="/Docs-DouSheng/assets/js/1.09f60839.js" defer></script><script src="/Docs-DouSheng/assets/js/12.f2b67662.js" defer></script>
  </body>
</html>
